HanulWiki.MAIN=METHOD({run:function(){"use strict";var n;1===CPU_CLUSTERING.getWorkerId()&&(n=SHARED_STORE("idStore"),HanulWiki.ArticleModel.find(function(e){var i=[];EACH(e,function(n){var e=0;EACH(i,function(i,t){return i.length<n.id.length?!1:void(e=t+1)}),i.splice(e,0,n.id)}),n.save({name:"ids",value:i})}))}}),OVERRIDE(HanulWiki.ArticleModel,function(n){"use strict";HanulWiki.ArticleModel=OBJECT({preset:function(){return n},init:function(n,e){var i=SHARED_STORE("idStore");1===CPU_CLUSTERING.getWorkerId()&&e.find({isFindAll:!0},function(n){var e=[];EACH(n,function(n){var i=0;EACH(e,function(e,t){return e.length<n.id.length?!1:void(i=t+1)}),e.splice(i,0,n.id)}),i.save({name:"ids",value:e})}),n.on("create",{before:function(n,e){var t=n.content.trim().replace(/ /g,"").toLowerCase(),o=i.get("ids");return n.keywords=[],EACH(o,function(e){var i=t.replace(new RegExp(e,"g"),"");i.length<t.length&&n.keywords.push(e),t=i}),GET({host:"tagengine.hanul.co",uri:"__TAG_INPUT",paramStr:"tag="+encodeURIComponent(n.id)},function(i){n.id=i,e()}),!1},after:function(n){var e=i.get("ids"),t=0;EACH(e,function(e,i){return e.length<n.id.length?!1:void(t=i+1)}),e.splice(t,0,n.id),i.save({name:"ids",value:e})}}),n.on("update",{before:function(n){var e,t;void 0!==n.content&&(e=n.content.trim().replace(/ /g,"").toLowerCase(),t=i.get("ids"),n.keywords=[],EACH(t,function(i){var t;i!==n.id&&(t=e.replace(new RegExp(i,"g"),""),t.length<e.length&&n.keywords.push(i),e=t)}))}}),n.on("remove",{after:function(n){var e=i.get("ids");REMOVE({array:e,value:n.id}),i.save({name:"ids",value:e})}}),n.on("get",function(n){e.update({id:n.id,$inc:{viewCount:1}}),n.viewCount+=1})}})}),HanulWiki.AuthRoom=OBJECT({init:function(){"use strict";HanulWiki.ROOM("authRoom",function(n,e){e("auth",function(e,i){e===NODE_CONFIG.HanulWiki.password&&(n.roles=["ADMIN"]),i(e===NODE_CONFIG.HanulWiki.password)})})}});