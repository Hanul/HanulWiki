HanulWiki.MAIN=METHOD({run:function(){"use strict";var n;1===CPU_CLUSTERING.getWorkerId()&&(n=SHARED_STORE("idStore"),HanulWiki.ArticleModel.find(function(i){var e=[];EACH(i,function(n){var i=0;EACH(e,function(e,t){return e.length<n.id.length?!1:void(i=t+1)}),e.splice(i,0,n.id)}),n.save({name:"ids",value:e})}))}}),OVERRIDE(HanulWiki.ArticleModel,function(n){"use strict";HanulWiki.ArticleModel=OBJECT({preset:function(){return n},init:function(n,i){var e=SHARED_STORE("idStore");1===CPU_CLUSTERING.getWorkerId()&&i.find({isFindAll:!0},function(n){var i=[];EACH(n,function(n){var e=0;EACH(i,function(i,t){return i.length<n.id.length?!1:void(e=t+1)}),i.splice(e,0,n.id)}),e.save({name:"ids",value:i})}),n.on("create",{before:function(n,t,o){var r=n.content.trim().replace(/ /g,"").toLowerCase(),u=e.get("ids");return n.keywords=[],EACH(u,function(i){var e=r.replace(new RegExp(i,"g"),"");e.length<r.length&&n.keywords.push(i),r=e}),GET({host:"tagengine.hanul.co",uri:"__TAG_INPUT",paramStr:"tag="+encodeURIComponent(n.id)},function(e){n.id=e,i.get(n.id,{notExists:t,success:function(){o({validErrors:{id:{type:"exists"}}})}})}),!1},after:function(n){var i=e.get("ids"),t=0;EACH(i,function(i,e){return i.length<n.id.length?!1:void(t=e+1)}),i.splice(t,0,n.id),e.save({name:"ids",value:i})}}),n.on("update",{before:function(n){var i,t;void 0!==n.content&&(i=n.content.trim().replace(/ /g,"").toLowerCase(),t=e.get("ids"),n.keywords=[],EACH(t,function(e){var t;e!==n.id&&(t=i.replace(new RegExp(e,"g"),""),t.length<i.length&&n.keywords.push(e),i=t)}))}}),n.on("remove",{after:function(n){var i=e.get("ids");REMOVE({array:i,value:n.id}),e.save({name:"ids",value:i})}}),n.on("get",function(n){i.update({id:n.id,$inc:{viewCount:1}}),n.viewCount+=1})}})}),HanulWiki.AuthRoom=OBJECT({init:function(){"use strict";HanulWiki.ROOM("authRoom",function(n,i){i("auth",function(i,e){var t=void 0!==CONFIG.HanulWiki&&CONFIG.HanulWiki.isPublic===!0||void 0!==NODE_CONFIG.HanulWiki&&i===NODE_CONFIG.HanulWiki.password;t===!0&&(n.roles=["ADMIN"]),e(t)})})}});